!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.thiss=t():e.thiss=t()}(this,(()=>(()=>{var e={684:function(e){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/index.js")}({"./src/index.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};function o(e){return"[object RegExp]"===Object.prototype.toString.call(e)}r.d(n,"cleanUpWindow",(function(){return be})),r.d(n,"Promise",(function(){return Y})),r.d(n,"bridge",(function(){return Pe})),r.d(n,"init",(function(){return Ae})),r.d(n,"parent",(function(){return Oe})),r.d(n,"send",(function(){return pe})),r.d(n,"request",(function(){return he})),r.d(n,"sendToParent",(function(){return we})),r.d(n,"client",(function(){return ye})),r.d(n,"on",(function(){return _e})),r.d(n,"listen",(function(){return me})),r.d(n,"once",(function(){return Ee})),r.d(n,"listener",(function(){return Se})),r.d(n,"CONFIG",(function(){return R})),r.d(n,"CONSTANTS",(function(){return A})),r.d(n,"disable",(function(){return ge}));var i={MOCK:"mock:",FILE:"file:",ABOUT:"about:"},a="*",u="Call was rejected by callee.\r\n";function c(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window).location.protocol===i.ABOUT}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;if(e)try{if(e.parent&&e.parent!==e)return e.parent}catch(e){}}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;if(e&&!s(e))try{return e.opener}catch(e){}}function d(e){try{return e&&e.location&&e.location.href,!0}catch(e){}return!1}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=e.location;if(!t)throw new Error("Can not read window location");var r=t.protocol;if(!r)throw new Error("Can not read window protocol");if(r===i.FILE)return i.FILE+"//";if(r===i.ABOUT){var n=s(e);return n&&d(n)?l(n):i.ABOUT+"//"}var o=t.host;if(!o)throw new Error("Can not read window host");return r+"//"+o}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=l(e);return t&&e.mockDomain&&0===e.mockDomain.indexOf(i.MOCK)?e.mockDomain:t}function p(e){try{if(e===window)return!0}catch(e){}try{var t=Object.getOwnPropertyDescriptor(e,"location");if(t&&!1===t.enumerable)return!1}catch(e){}try{if(c(e)&&d(e))return!0}catch(e){}try{if(l(e)===l(window))return!0}catch(e){}return!1}function w(e,t){if(!e||!t)return!1;var r=s(t);return r?r===e:-1!==function(e){var t=[];try{for(;e.parent!==e;)t.push(e.parent),e=e.parent}catch(e){}return t}(t).indexOf(e)}function y(e){var t=[],r=void 0;try{r=e.frames}catch(t){r=e}var n=void 0;try{n=r.length}catch(e){}if(0===n)return t;if(n){for(var o=0;o<n;o++){var i=void 0;try{i=r[o]}catch(e){continue}t.push(i)}return t}for(var a=0;a<100;a++){var u=void 0;try{u=r[a]}catch(e){return t}if(!u)return t;t.push(u)}return t}var v=[],m=[];function _(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{if(e===window)return!1}catch(e){return!0}try{if(!e)return!0}catch(e){return!0}try{if(e.closed)return!0}catch(e){return!e||e.message!==u}if(t&&function(e){if(!p(e))return!1;try{if(e===window)return!0;if(c(e)&&d(e))return!0;if(h(window)===h(e))return!0}catch(e){}return!1}(e))try{if(e.mockclosed)return!0}catch(e){}try{if(!e.parent||!e.top)return!0}catch(e){}var r=function(e,t){for(var r=0;r<e.length;r++)try{if(e[r]===t)return r}catch(e){}return-1}(v,e);if(-1!==r){var n=m[r];if(n&&function(e){if(!e.contentWindow)return!0;if(!e.parentNode)return!0;var t=e.ownerDocument;return!(!t||!t.documentElement||t.documentElement.contains(e))}(n))return!0}return!1}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return f(e=e||window)||s(e)||void 0}function S(e,t){if("string"==typeof e){if("string"==typeof t)return e===a||t===e;if(o(t))return!1;if(Array.isArray(t))return!1}return o(e)?o(t)?e.toString()===t.toString():!Array.isArray(t)&&Boolean(t.match(e)):!!Array.isArray(e)&&(Array.isArray(t)?JSON.stringify(e)===JSON.stringify(t):!o(t)&&e.some((function(e){return S(e,t)})))}function g(e){try{if(e===window)return!0}catch(e){if(e&&e.message===u)return!0}try{if("[object Window]"===Object.prototype.toString.call(e))return!0}catch(e){if(e&&e.message===u)return!0}try{if(window.Window&&e instanceof window.Window)return!0}catch(e){if(e&&e.message===u)return!0}try{if(e&&e.self===e)return!0}catch(e){if(e&&e.message===u)return!0}try{if(e&&e.parent===e)return!0}catch(e){if(e&&e.message===u)return!0}try{if(e&&e.top===e)return!0}catch(e){if(e&&e.message===u)return!0}try{if(e&&"__unlikely_value__"===e.__cross_domain_utils_window_check__)return!1}catch(e){return!0}return!1}function O(e,t){for(var r=0;r<e.length;r++)try{if(e[r]===t)return r}catch(e){}return-1}var b,P=function(){function e(){if(function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__",function(){if("undefined"==typeof WeakMap)return!1;if(void 0===Object.freeze)return!1;try{var e=new WeakMap,t={};return Object.freeze(t),e.set(t,"__testvalue__"),"__testvalue__"===e.get(t)}catch(e){return!1}}())try{this.weakmap=new WeakMap}catch(e){}this.keys=[],this.values=[]}return e.prototype._cleanupClosedWindows=function(){for(var e=this.weakmap,t=this.keys,r=0;r<t.length;r++){var n=t[r];if(g(n)&&_(n)){if(e)try{e.delete(n)}catch(e){}t.splice(r,1),this.values.splice(r,1),r-=1}}},e.prototype.isSafeToReadWrite=function(e){if(g(e))return!1;try{e&&e.self,e&&e[this.name]}catch(e){return!1}return!0},e.prototype.set=function(e,t){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{r.set(e,t)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var n=this.name,o=e[n];return void(o&&o[0]===e?o[1]=t:Object.defineProperty(e,n,{value:[e,t],writable:!0}))}catch(e){}this._cleanupClosedWindows();var i=this.keys,a=this.values,u=O(i,e);-1===u?(i.push(e),a.push(t)):a[u]=t},e.prototype.get=function(e){if(!e)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{if(t.has(e))return t.get(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var r=e[this.name];return r&&r[0]===e?r[1]:void 0}catch(e){}this._cleanupClosedWindows();var n=O(this.keys,e);if(-1!==n)return this.values[n]},e.prototype.delete=function(e){if(!e)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{t.delete(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var r=e[this.name];r&&r[0]===e&&(r[0]=r[1]=void 0)}catch(e){}this._cleanupClosedWindows();var n=this.keys,o=O(n,e);-1!==o&&(n.splice(o,1),this.values.splice(o,1))},e.prototype.has=function(e){if(!e)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{if(t.has(e))return!0}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var r=e[this.name];return!(!r||r[0]!==e)}catch(e){}return this._cleanupClosedWindows(),-1!==O(this.keys,e)},e.prototype.getOrSet=function(e,t){if(this.has(e))return this.get(e);var r=t();return this.set(e,r),r},e}(),A={POST_MESSAGE_TYPE:{REQUEST:"postrobot_message_request",RESPONSE:"postrobot_message_response",ACK:"postrobot_message_ack"},POST_MESSAGE_ACK:{SUCCESS:"success",ERROR:"error"},POST_MESSAGE_NAMES:{METHOD:"postrobot_method",HELLO:"postrobot_ready",OPEN_TUNNEL:"postrobot_open_tunnel"},WINDOW_TYPES:{FULLPAGE:"fullpage",POPUP:"popup",IFRAME:"iframe"},WINDOW_PROPS:{POSTROBOT:"__postRobot__"},SERIALIZATION_TYPES:{METHOD:"postrobot_method",ERROR:"postrobot_error",PROMISE:"postrobot_promise",ZALGO_PROMISE:"postrobot_zalgo_promise",REGEX:"regex"},SEND_STRATEGIES:{POST_MESSAGE:"postrobot_post_message",BRIDGE:"postrobot_bridge",GLOBAL:"postrobot_global"},MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",BRIDGE_NAME_PREFIX:"__postrobot_bridge__",POSTROBOT_PROXY:"__postrobot_proxy__",WILDCARD:"*"},T={METHOD:"postrobot_method",HELLO:"postrobot_hello",OPEN_TUNNEL:"postrobot_open_tunnel"},R=(Object.keys(T).map((function(e){return T[e]})),{ALLOW_POSTMESSAGE_POPUP:!("__ALLOW_POSTMESSAGE_POPUP__"in window)||window.__ALLOW_POSTMESSAGE_POPUP__,BRIDGE_TIMEOUT:5e3,CHILD_WINDOW_TIMEOUT:5e3,ACK_TIMEOUT:-1!==window.navigator.userAgent.match(/MSIE/i)?1e4:2e3,RES_TIMEOUT:-1,ALLOWED_POST_MESSAGE_METHODS:(b={},b[A.SEND_STRATEGIES.POST_MESSAGE]=!0,b[A.SEND_STRATEGIES.BRIDGE]=!0,b[A.SEND_STRATEGIES.GLOBAL]=!0,b),ALLOW_SAME_ORIGIN:!1});0===window.location.href.indexOf(A.FILE_PROTOCOL)&&(R.ALLOW_POSTMESSAGE_POPUP=!0);var I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t>=3)return"stringifyError stack overflow";try{if(!e)return"<unknown error: "+Object.prototype.toString.call(e)+">";if("string"==typeof e)return e;if(e instanceof Error){var r=e&&e.stack,n=e&&e.message;if(r&&n)return-1!==r.indexOf(n)?r:n+"\n"+r;if(r)return r;if(n)return n}return"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e)}catch(e){return"Error while stringifying error: "+j(e,t+1)}}var W=function(e){if(!e)return e;var t=!1;return function(){if(!t)return t=!0,e.apply(this,arguments)}};function L(){}function D(){var e="0123456789abcdef";return"xxxxxxxxxx".replace(/./g,(function(){return e.charAt(Math.floor(16*Math.random()))}))}function M(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(r>=100)throw new Error("Self-referential object passed, or object contained too many layers");var n=void 0;if("object"!==(void 0===e?"undefined":I(e))||null===e||Array.isArray(e)){if(!Array.isArray(e))throw new TypeError("Invalid type: "+(void 0===e?"undefined":I(e)));n=[]}else n={};return function(e,t){Array.isArray(e)?function(e,t){for(var r=0;r<e.length;r++)t(e[r],r)}(e,t):"object"===(void 0===e?"undefined":I(e))&&null!==e&&function(e,t){for(var r in e)e.hasOwnProperty(r)&&t(e[r],r)}(e,t)}(e,(function(e,o){var i=t(e,o);void 0!==i?n[o]=i:"object"===(void 0===e?"undefined":I(e))&&null!==e?n[o]=M(e,t,r+1):n[o]=e})),n}function C(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function x(e){try{if(!e)return!1;if("undefined"!=typeof Promise&&e instanceof Promise)return!0;if("undefined"!=typeof window&&"function"==typeof window.Window&&e instanceof window.Window)return!1;if("undefined"!=typeof window&&"function"==typeof window.constructor&&e instanceof window.constructor)return!1;var t={}.toString;if(t){var r=t.call(e);if("[object Window]"===r||"[object global]"===r||"[object DOMWindow]"===r)return!1}if("function"==typeof e.then)return!0}catch(e){return!1}return!1}var N=[],k=[],G=0,q=void 0;function U(){if(!G&&q){var e=q;q=null,e.resolve()}}function B(){G+=1}function H(){G-=1,U()}var Y=function(){function e(t){var r=this;if(function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],t){var n=void 0,o=void 0,i=!1,a=!1,u=!1;B();try{t((function(e){u?r.resolve(e):(i=!0,n=e)}),(function(e){u?r.reject(e):(a=!0,o=e)}))}catch(e){return H(),void this.reject(e)}H(),u=!0,i?this.resolve(n):a&&this.reject(o)}}return e.prototype.resolve=function(e){if(this.resolved||this.rejected)return this;if(x(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this},e.prototype.reject=function(e){var t=this;if(this.resolved||this.rejected)return this;if(x(e))throw new Error("Can not reject promise with another promise");if(!e){var r=e&&"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);e=new Error("Expected reject to be called with Error, got "+r)}return this.rejected=!0,this.error=e,this.errorHandled||setTimeout((function(){t.errorHandled||function(e,t){if(-1===N.indexOf(e)){N.push(e),setTimeout((function(){throw e}),1);for(var r=0;r<k.length;r++)k[r](e,t)}}(e,t)}),1),this.dispatch(),this},e.prototype.asyncReject=function(e){return this.errorHandled=!0,this.reject(e),this},e.prototype.dispatch=function(){var t=this.dispatching,r=this.resolved,n=this.rejected,o=this.handlers;if(!t&&(r||n)){this.dispatching=!0,B();for(var i=function(e,t){return e.then((function(e){t.resolve(e)}),(function(e){t.reject(e)}))},a=0;a<o.length;a++){var u=o[a],c=u.onSuccess,s=u.onError,f=u.promise,d=void 0;if(r)try{d=c?c(this.value):this.value}catch(e){f.reject(e);continue}else if(n){if(!s){f.reject(this.error);continue}try{d=s(this.error)}catch(e){f.reject(e);continue}}d instanceof e&&(d.resolved||d.rejected)?(d.resolved?f.resolve(d.value):f.reject(d.error),d.errorHandled=!0):x(d)?d instanceof e&&(d.resolved||d.rejected)?d.resolved?f.resolve(d.value):f.reject(d.error):i(d,f):f.resolve(d)}o.length=0,this.dispatching=!1,H()}},e.prototype.then=function(t,r){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.then expected a function for success handler");if(r&&"function"!=typeof r&&!r.call)throw new Error("Promise.then expected a function for error handler");var n=new e;return this.handlers.push({promise:n,onSuccess:t,onError:r}),this.errorHandled=!0,this.dispatch(),n},e.prototype.catch=function(e){return this.then(void 0,e)},e.prototype.finally=function(t){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.finally expected a function");return this.then((function(r){return e.try(t).then((function(){return r}))}),(function(r){return e.try(t).then((function(){throw r}))}))},e.prototype.timeout=function(e,t){var r=this;if(this.resolved||this.rejected)return this;var n=setTimeout((function(){r.resolved||r.rejected||r.reject(t||new Error("Promise timed out after "+e+"ms"))}),e);return this.then((function(e){return clearTimeout(n),e}))},e.prototype.toPromise=function(){if("undefined"==typeof Promise)throw new TypeError("Could not find Promise");return Promise.resolve(this)},e.resolve=function(t){return t instanceof e?t:x(t)?new e((function(e,r){return t.then(e,r)})):(new e).resolve(t)},e.reject=function(t){return(new e).reject(t)},e.asyncReject=function(t){return(new e).asyncReject(t)},e.all=function(t){var r=new e,n=t.length,o=[];if(!n)return r.resolve(o),r;for(var i=function(e,t,i){return t.then((function(t){o[e]=t,0==(n-=1)&&r.resolve(o)}),(function(e){i.reject(e)}))},a=0;a<t.length;a++){var u=t[a];if(u instanceof e){if(u.resolved){o[a]=u.value,n-=1;continue}}else if(!x(u)){o[a]=u,n-=1;continue}i(a,e.resolve(u),r)}return 0===n&&r.resolve(o),r},e.hash=function(t){var r={};return e.all(Object.keys(t).map((function(n){return e.resolve(t[n]).then((function(e){r[n]=e}))}))).then((function(){return r}))},e.map=function(t,r){return e.all(t.map(r))},e.onPossiblyUnhandledException=function(e){return function(e){return k.push(e),{cancel:function(){k.splice(k.indexOf(e),1)}}}(e)},e.try=function(t,r,n){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.try expected a function");var o=void 0;B();try{o=t.apply(r,n||[])}catch(t){return H(),e.reject(t)}return H(),e.resolve(o)},e.delay=function(t){return new e((function(e){setTimeout(e,t)}))},e.isPromise=function(t){return!!(t&&t instanceof e)||x(t)},e.flush=function(){return t=q=q||new e,U(),t;var t},e}(),F=window[A.WINDOW_PROPS.POSTROBOT]=window[A.WINDOW_PROPS.POSTROBOT]||{};F.registerSelf=function(){};var J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};F.methods=F.methods||new P;var K=W((function(){F.on(A.POST_MESSAGE_NAMES.METHOD,{origin:A.WILDCARD},(function(e){var t=e.source,r=e.origin,n=e.data,o=F.methods.get(t);if(!o)throw new Error("Could not find any methods this window has privileges to call");var i=o[n.id];if(!i)throw new Error("Could not find method with id: "+n.id);if(!S(i.domain,r))throw new Error("Method domain "+i.domain+" does not match origin "+r);return Y.try((function(){return i.method.apply({source:t,origin:r,data:n},n.args)})).then((function(e){return{result:e,id:n.id,name:n.name}}))}))}));function Z(e,t){return"object"===(void 0===e?"undefined":J(e))&&null!==e&&e.__type__===t}function z(e,t,r,n){var o=D(),i=F.methods.get(e);return i||(i={},F.methods.set(e,i)),i[o]={domain:t,method:r},{__type__:A.SERIALIZATION_TYPES.METHOD,__id__:o,__name__:n}}function X(e,t,r){function n(){var n=Array.prototype.slice.call(arguments);return F.send(e,A.POST_MESSAGE_NAMES.METHOD,{id:r.__id__,name:r.__name__,args:n},{domain:t,timeout:-1}).then((function(e){return e.data.result}),(function(e){throw e}))}return n.__name__=r.__name__,n.__xdomain__=!0,n.source=e,n.origin=t,n}function Q(e,t,r){return new Y((function(n,o){return X(e,t,r.__then__)(n,o)}))}function V(e){return F.send(e,A.POST_MESSAGE_NAMES.HELLO,{},{domain:A.WILDCARD,timeout:-1}).then((function(e){return{origin:e.origin}}))}F.readyPromises=F.readyPromises||new P;var $={};$[A.SEND_STRATEGIES.POST_MESSAGE]=function(e,t,r){(Array.isArray(r)?r:"string"==typeof r?[r]:[A.WILDCARD]).map((function(t){if(0===t.indexOf(A.MOCK_PROTOCOL)){if(window.location.protocol===A.FILE_PROTOCOL)return A.WILDCARD;if(!p(e))throw new Error("Attempting to send messsage to mock domain "+t+", but window is actually cross-domain");return l(e)}return 0===t.indexOf(A.FILE_PROTOCOL)?A.WILDCARD:t})).forEach((function(r){return e.postMessage(t,r)}))};var ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function te(e,t,r){return Y.try((function(){var n;if(t=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=D(),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return Boolean(f(e))}()?A.WINDOW_TYPES.POPUP:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return Boolean(s(e))}()?A.WINDOW_TYPES.IFRAME:A.WINDOW_TYPES.FULLPAGE,i=h(window);return ee({},t,r,{sourceDomain:i,id:t.id||n,windowType:o})}(e,t,{data:function(e,r){return M({obj:t.data},(function(t,n){return"function"==typeof t?z(e,r,t,n.toString()):t instanceof Error?(o=t,{__type__:A.SERIALIZATION_TYPES.ERROR,__message__:j(o),__code__:o.code}):window.Promise&&t instanceof window.Promise?function(e,t,r,n){return{__type__:A.SERIALIZATION_TYPES.PROMISE,__then__:z(e,t,(function(e,t){return r.then(e,t)}),n+".then")}}(e,r,t,n.toString()):Y.isPromise(t)?function(e,t,r,n){return{__type__:A.SERIALIZATION_TYPES.ZALGO_PROMISE,__then__:z(e,t,(function(e,t){return r.then(e,t)}),n+".then")}}(e,r,t,n.toString()):C(t)?(i=t,{__type__:A.SERIALIZATION_TYPES.REGEX,__source__:i.source}):void 0;var o,i})).obj}(e,r),domain:r}),e===window&&!R.ALLOW_SAME_ORIGIN)throw new Error("Attemping to send message to self");if(_(e))throw new Error("Window is closed");var o=[],i=function(e){var t=void 0,r=void 0;try{if("{}"!==JSON.stringify({})&&(t=Object.prototype.toJSON,delete Object.prototype.toJSON),"{}"!==JSON.stringify({}))throw new Error("Can not correctly serialize JSON objects");if("[]"!==JSON.stringify([])&&(r=Array.prototype.toJSON,delete Array.prototype.toJSON),"[]"!==JSON.stringify([]))throw new Error("Can not correctly serialize JSON objects")}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}var n=JSON.stringify.call(this,e,null,2);try{t&&(Object.prototype.toJSON=t),r&&(Array.prototype.toJSON=r)}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}return n}(((n={})[A.WINDOW_PROPS.POSTROBOT]=t,n));return Y.map(Object.keys($),(function(t){return Y.try((function(){if(!R.ALLOWED_POST_MESSAGE_METHODS[t])throw new Error("Strategy disallowed: "+t);return $[t](e,i,r)})).then((function(){return o.push(t+": success"),!0}),(function(e){return o.push(t+": "+j(e)+"\n"),!1}))})).then((function(e){var r=e.some(Boolean),n=t.type+" "+t.name+" "+(r?"success":"error")+":\n  - "+o.join("\n  - ")+"\n";if(!r)throw new Error(n)}))}))}F.responseListeners=F.responseListeners||{},F.requestListeners=F.requestListeners||{},F.WINDOW_WILDCARD=F.WINDOW_WILDCARD||new function(){},F.erroredResponseListeners=F.erroredResponseListeners||{};var re,ne="__domain_regex__";function oe(e){return F.responseListeners[e]}function ie(e){delete F.responseListeners[e]}function ae(e){return Boolean(F.erroredResponseListeners[e])}function ue(e){var t=e.name,r=e.win,n=e.domain;if(r===A.WILDCARD&&(r=null),n===A.WILDCARD&&(n=null),!t)throw new Error("Name required to get request listener");var o=F.requestListeners[t];if(o)for(var i=0,a=[r,F.WINDOW_WILDCARD],u=null==a?0:a.length;i<u;i++){var c=a[i],s=c&&o.get(c);if(s){if(n&&"string"==typeof n){if(s[n])return s[n];if(s[ne])for(var f=0,d=s[ne],l=null==d?0:d.length;f<l;f++){var h=d[f],p=h.regex,w=h.listener;if(S(p,n))return w}}if(s[A.WILDCARD])return s[A.WILDCARD]}}}var ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},se=((re={})[A.POST_MESSAGE_TYPE.ACK]=function(e,t,r){if(!ae(r.hash)){var n=oe(r.hash);if(!n)throw new Error("No handler found for post message ack for message: "+r.name+" from "+t+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!S(n.domain,t))throw new Error("Ack origin "+t+" does not match domain "+n.domain.toString());n.ack=!0}},re[A.POST_MESSAGE_TYPE.REQUEST]=function(e,t,r){var n=ue({name:r.name,win:e,domain:t});function o(n){return r.fireAndForget||_(e)?Y.resolve():te(e,ce({target:r.originalSource,hash:r.hash,name:r.name},n),t)}return Y.all([o({type:A.POST_MESSAGE_TYPE.ACK}),Y.try((function(){if(!n)throw new Error("No handler found for post message: "+r.name+" from "+t+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!S(n.domain,t))throw new Error("Request origin "+t+" does not match domain "+n.domain.toString());var o=r.data;return n.handler({source:e,origin:t,data:o})})).then((function(e){return o({type:A.POST_MESSAGE_TYPE.RESPONSE,ack:A.POST_MESSAGE_ACK.SUCCESS,data:e})}),(function(e){var t=j(e).replace(/^Error: /,""),r=e.code;return o({type:A.POST_MESSAGE_TYPE.RESPONSE,ack:A.POST_MESSAGE_ACK.ERROR,error:t,code:r})}))]).then(L).catch((function(e){if(n&&n.handleError)return n.handleError(e);throw e}))},re[A.POST_MESSAGE_TYPE.RESPONSE]=function(e,t,r){if(!ae(r.hash)){var n,i=oe(r.hash);if(!i)throw new Error("No handler found for post message response for message: "+r.name+" from "+t+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!S(i.domain,t))throw new Error("Response origin "+t+" does not match domain "+(n=i.domain,Array.isArray(n)?"("+n.join(" | ")+")":o(n)?"RegExp("+n.toString():n.toString()));if(ie(r.hash),r.ack===A.POST_MESSAGE_ACK.ERROR){var a=new Error(r.error);return r.code&&(a.code=r.code),i.respond(a,null)}if(r.ack===A.POST_MESSAGE_ACK.SUCCESS){var u=r.data||r.response;return i.respond(null,{source:e,origin:t,data:u})}}},re),fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function de(e){if(window&&!window.closed){try{if(!e.source)return}catch(e){return}var t=e.source,r=e.origin,n=function(e){var t,r=void 0;try{t=e,r=JSON.parse(t)}catch(e){return}if(r&&"object"===(void 0===r?"undefined":fe(r))&&null!==r&&(r=r[A.WINDOW_PROPS.POSTROBOT])&&"object"===(void 0===r?"undefined":fe(r))&&null!==r&&r.type&&"string"==typeof r.type&&se[r.type])return r}(e.data);if(n){if(!n.sourceDomain||"string"!=typeof n.sourceDomain)throw new Error("Expected message to have sourceDomain");0!==n.sourceDomain.indexOf(A.MOCK_PROTOCOL)&&0!==n.sourceDomain.indexOf(A.FILE_PROTOCOL)||(r=n.sourceDomain),-1===F.receivedMessages.indexOf(n.id)&&(F.receivedMessages.push(n.id),_(t)&&!n.fireAndForget||(n.data&&(n.data=function(e,t){return M({obj:n.data},(function(r){if("object"===(void 0===r?"undefined":J(r))&&null!==r)return Z(r,A.SERIALIZATION_TYPES.METHOD)?X(e,t,r):Z(r,A.SERIALIZATION_TYPES.ERROR)?(n=r,o=new Error(n.__message__),n.__code__&&(o.code=n.__code__),o):Z(r,A.SERIALIZATION_TYPES.PROMISE)?function(e,t,r){return window.Promise?new window.Promise((function(n,o){return X(e,t,r.__then__)(n,o)})):Q(e,t,r)}(e,t,r):Z(r,A.SERIALIZATION_TYPES.ZALGO_PROMISE)?Q(e,t,r):Z(r,A.SERIALIZATION_TYPES.REGEX)?function(e,t,r){return new RegExp(r.__source__)}(0,0,r):void 0;var n,o})).obj}(t,r)),se[n.type](t,r,n)))}}}function le(e){try{e.source}catch(e){return}de({source:e.source||e.sourceElement,origin:e.origin||e.originalEvent&&e.originalEvent.origin,data:e.data})}function he(e){return Y.try((function(){if(!e.name)throw new Error("Expected options.name");var t=e.name,r=void 0,n=void 0;if("string"==typeof e.window){var o=document.getElementById(e.window);if(!o)throw new Error("Expected options.window "+Object.prototype.toString.call(e.window)+" to be a valid element id");if("iframe"!==o.tagName.toLowerCase())throw new Error("Expected options.window "+Object.prototype.toString.call(e.window)+" to be an iframe");if(!o.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");r=o.contentWindow}else if(e.window instanceof HTMLIFrameElement){if("iframe"!==e.window.tagName.toLowerCase())throw new Error("Expected options.window "+Object.prototype.toString.call(e.window)+" to be an iframe");if(e.window&&!e.window.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");e.window&&e.window.contentWindow&&(r=e.window.contentWindow)}else r=e.window;if(!r)throw new Error("Expected options.window to be a window object, iframe, or iframe element id.");var i=r;n=e.domain||A.WILDCARD;var a=e.name+"_"+D();if(_(i))throw new Error("Target window is closed");var u=!1,c=F.requestPromises.get(i);c||(c=[],F.requestPromises.set(i,c));var f=Y.try((function(){if(function(e,t){var r=E(t);if(r)return r===e;if(t===e)return!1;if(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;try{if(e.top)return e.top}catch(e){}if(s(e)===e)return e;try{if(w(window,e)&&window.top)return window.top}catch(e){}try{if(w(e,window)&&window.top)return window.top}catch(e){}for(var t=0,r=function e(t){for(var r=[],n=0,o=y(t),i=null==o?0:o.length;n<i;n++){var a=o[n];r.push(a);for(var u=0,c=e(a),s=null==c?0:c.length;u<s;u++){var f=c[u];r.push(f)}}return r}(e),n=null==r?0:r.length;t<n;t++){var o=r[t];try{if(o.top)return o.top}catch(e){}if(s(o)===o)return o}}(t)===t)return!1;for(var n=0,o=y(e),i=null==o?0:o.length;n<i;n++)if(o[n]===t)return!0;return!1}(window,i))return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Window",n=F.readyPromises.get(e);return n||(n=new Y,F.readyPromises.set(e,n),-1!==t&&setTimeout((function(){return n.reject(new Error(r+" did not load after "+t+"ms"))}),t),n)}(i,e.timeout||R.CHILD_WINDOW_TIMEOUT)})).then((function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).origin;if(C(n)&&!e)return V(i)})).then((function(){var r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).origin;if(C(n)){if(!S(n,r))throw new Error("Remote window domain "+r+" does not match regex: "+n.toString());n=r}if("string"!=typeof n&&!Array.isArray(n))throw new TypeError("Expected domain to be a string or array");var o=n;return new Y((function(r,n){var s=void 0;if(e.fireAndForget||function(e,t){F.responseListeners[e]=t}(a,s={name:t,window:i,domain:o,respond:function(e,t){e||(u=!0,c.splice(c.indexOf(f,1))),e?n(e):r(t)}}),te(i,{type:A.POST_MESSAGE_TYPE.REQUEST,hash:a,name:t,data:e.data,fireAndForget:e.fireAndForget},o).catch(n),e.fireAndForget)return r();var d=R.ACK_TIMEOUT,l=e.timeout||R.RES_TIMEOUT,p=100;setTimeout((function r(){if(!u){if(_(i))return s.ack?n(new Error("Window closed for "+t+" before response")):n(new Error("Window closed for "+t+" before ack"));if(d=Math.max(d-p,0),-1!==l&&(l=Math.max(l-p,0)),s.ack){if(-1===l)return;p=Math.min(l,2e3)}else{if(0===d)return n(new Error("No ack for postMessage "+t+" in "+h()+" in "+R.ACK_TIMEOUT+"ms"));if(0===l)return n(new Error("No response for postMessage "+t+" in "+h()+" in "+(e.timeout||R.RES_TIMEOUT)+"ms"))}setTimeout(r,p)}}),p)}))}));return f.catch((function(){!function(e){F.erroredResponseListeners[e]=!0}(a),ie(a)})),c.push(f),f}))}function pe(e,t,r,n){return(n=n||{}).window=e,n.name=t,n.data=r,he(n)}function we(e,t,r){var n=E();return n?pe(n,e,t,r):new Y((function(e,t){return t(new Error("Window does not have a parent"))}))}function ye(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.window)throw new Error("Expected options.window");var t=e.window;return{send:function(r,n){return pe(t,r,n,e)}}}F.receivedMessages=F.receivedMessages||[],F.receiveMessage=de,F.requestPromises=F.requestPromises||new P,F.send=pe;var ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function me(e){if(!e.name)throw new Error("Expected options.name");if(!e.handler)throw new Error("Expected options.handler");var t,r=e.name,n=e.window,o=e.domain,i={handler:e.handler,handleError:e.errorHandler||function(e){throw e},window:n,domain:o||A.WILDCARD,name:r},a=function e(t,r){var n=t.name,o=t.win,i=t.domain;if(!n||"string"!=typeof n)throw new Error("Name required to add request listener");if(Array.isArray(o)){for(var a=[],u=0,c=o,s=null==c?0:c.length;u<s;u++){var f=c[u];a.push(e({name:n,domain:i,win:f},r))}return{cancel:function(){for(var e=0,t=null==a?0:a.length;e<t;e++)a[e].cancel()}}}if(Array.isArray(i)){for(var d=[],l=0,h=i,p=null==h?0:h.length;l<p;l++){var w=h[l];d.push(e({name:n,win:o,domain:w},r))}return{cancel:function(){for(var e=0,t=null==d?0:d.length;e<t;e++)d[e].cancel()}}}var y=ue({name:n,win:o,domain:i});if(o&&o!==A.WILDCARD||(o=F.WINDOW_WILDCARD),i=i||A.WILDCARD,y)throw o&&i?new Error("Request listener already exists for "+n+" on domain "+i.toString()+" for "+(o===F.WINDOW_WILDCARD?"wildcard":"specified")+" window"):o?new Error("Request listener already exists for "+n+" for "+(o===F.WINDOW_WILDCARD?"wildcard":"specified")+" window"):i?new Error("Request listener already exists for "+n+" on domain "+i.toString()):new Error("Request listener already exists for "+n);var v=F.requestListeners,m=v[n];m||(m=new P,v[n]=m);var _=m.get(o);_||(_={},m.set(o,_));var E=i.toString(),S=_[ne],g=void 0;return C(i)?(S||(S=[],_[ne]=S),g={regex:i,listener:r},S.push(g)):_[E]=r,{cancel:function(){_&&(delete _[E],o&&0===Object.keys(_).length&&m.delete(o),g&&S.splice(S.indexOf(g,1)))}}}({name:r,win:n,domain:o},i);if(e.once){var u=i.handler;i.handler=W((function(){return a.cancel(),u.apply(this,arguments)}))}if(i.window&&e.errorOnClose)var c=(t=void 0,t=setTimeout((function e(){t=setTimeout(e,50),function(){n&&"object"===(void 0===n?"undefined":ve(n))&&_(n)&&(c.cancel(),i.handleError(new Error("Post message target window is closed")))}.call()}),50),{cancel:function(){clearTimeout(t)}});return{cancel:function(){a.cancel()}}}function _e(e,t,r){return"function"==typeof t&&(r=t,t={}),(t=t||{}).name=e,t.handler=r||t.handler,me(t)}function Ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];"function"==typeof t&&(r=t,t={}),t=t||{},r=r||t.handler;var n=t.errorHandler,o=new Y((function(o,i){(t=t||{}).name=e,t.once=!0,t.handler=function(e){if(o(e),r)return r(e)},t.errorHandler=function(e){if(i(e),n)return n(e)}})),i=me(t);return o.cancel=i.cancel,o}function Se(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{on:function(t,r){return _e(t,e,r)}}}function ge(){delete window[A.WINDOW_PROPS.POSTROBOT],window.removeEventListener("message",le)}F.on=_e;var Oe=E();function be(e){var t=F.requestPromises.get(e);if(t)for(var r=0,n=null==t?0:t.length;r<n;r++)t[r].reject(new Error("No response from window - cleaned up"));F.popupWindowsByWin&&F.popupWindowsByWin.delete(e),F.remoteWindows&&F.remoteWindows.delete(e),F.requestPromises.delete(e),F.methods.delete(e),F.readyPromises.delete(e)}var Pe=null;function Ae(){var e,t;F.initialized||(t=le,(e=window).addEventListener?e.addEventListener("message",t):e.attachEvent("onmessage",t),function(){e=function(e){var t=e.source,r=e.origin,n=F.readyPromises.get(t)||new Y;n.resolve({origin:r}),F.readyPromises.set(t,n)},F.on(A.POST_MESSAGE_NAMES.HELLO,{domain:A.WILDCARD},(function(t){var r=t.source,n=t.origin;return e({source:r,origin:n})}));var e,t=E();t&&V(t).catch(L)}(),K({on:_e,send:pe})),F.initialized=!0}Ae(),r.d(t,"cleanUpWindow",(function(){return be})),r.d(t,"Promise",(function(){return Y})),r.d(t,"bridge",(function(){return Pe})),r.d(t,"init",(function(){return Ae})),r.d(t,"parent",(function(){return Oe})),r.d(t,"send",(function(){return pe})),r.d(t,"request",(function(){return he})),r.d(t,"sendToParent",(function(){return we})),r.d(t,"client",(function(){return ye})),r.d(t,"on",(function(){return _e})),r.d(t,"listen",(function(){return me})),r.d(t,"once",(function(){return Ee})),r.d(t,"listener",(function(){return Se})),r.d(t,"CONFIG",(function(){return R})),r.d(t,"CONSTANTS",(function(){return A})),r.d(t,"disable",(function(){return ge})),t.default=n}})},702:(e,t,r)=>{e.exports=r(684),e.exports.default=e.exports}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{DiscoveryService:()=>P,PersistenceService:()=>u,ds_response_url:()=>b,json_mdq:()=>m,json_mdq_get:()=>E,json_mdq_get_sp:()=>S,json_mdq_pre_get:()=>_,json_mdq_search:()=>g,parse_qs:()=>O});var e=r(702),t=r.n(e);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function a(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}var u=function(){return e=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t,r|={},this._frame=this.create_iframe(t),this.dst=this._frame.contentWindow||this._frame,this.apikey=r.apikey||void 0},(r=[{key:"create_iframe",value:function(e){var t=window.document.createElement("iframe");return t.style.display="none",t.style.position="absolute",t.style.top="-999px",t.style.left="-999px",t.id="ps_"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10),window.document.body.appendChild(t),t.src=e,t}},{key:"update",value:function(e,r){return t().send(this.dst,"update",{context:e,entity:r,apikey:this.apikey})}},{key:"entities",value:function(e){return t().send(this.dst,"entities",{context:e,apikey:this.apikey})}},{key:"remove",value:function(e,r){return t().send(this.dst,"remove",{context:e,entity_id:r,apikey:this.apikey})}},{key:"entity",value:function(e,r){return t().send(this.dst,"entity",{context:e,entity_id:r,apikey:this.apikey})}}])&&i(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r}(),c=0;function s(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function f(e,t){return e<<t|e>>>32-t}function d(e,t,r,n){return e<20?t&r|~t&n:e<40?t^r^n:e<60?t&r|t&n|r&n:t^r^n}function l(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function h(e){return function(e){for(var t,r=c?"0123456789ABCDEF":"0123456789abcdef",n="",o=0;o<e.length;o++)t=e.charCodeAt(o),n+=r.charAt(t>>>4&15)+r.charAt(15&t);return n}(function(e){return function(e){for(var t="",r=0;r<32*e.length;r+=8)t+=String.fromCharCode(e[r>>5]>>>24-r%32&255);return t}(function(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var r=Array(80),n=1732584193,o=-271733879,i=-1732584194,a=271733878,u=-1009589776,c=0;c<e.length;c+=16){for(var h=n,p=o,w=i,y=a,v=u,m=0;m<80;m++){r[m]=m<16?e[c+m]:f(r[m-3]^r[m-8]^r[m-14]^r[m-16],1);var _=s(s(f(n,5),d(m,o,i,a)),s(s(u,r[m]),l(m)));u=a,a=i,i=f(o,30),o=n,n=_}n=s(n,h),o=s(o,p),i=s(i,w),a=s(a,y),u=s(u,v)}return Array(n,o,i,a,u)}(function(e){for(var t=Array(e.length>>2),r=0;r<t.length;r++)t[r]=0;for(r=0;r<8*e.length;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<24-r%32;return t}(e),8*e.length))}(function(e){for(var t,r,n="",o=-1;++o<e.length;)t=e.charCodeAt(o),r=o+1<e.length?e.charCodeAt(o+1):0,55296<=t&&t<=56319&&56320<=r&&r<=57343&&(t=65536+((1023&t)<<10)+(1023&r),o++),t<=127?n+=String.fromCharCode(t):t<=2047?n+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n}(e)))}function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function y(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=p(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}function v(e){return"{sha1}"+h(e)}function m(e){return console.log("json_mdq url: ",e),fetch(e,{method:"GET",headers:{Accept:"application/json"}}).then((function(t){if(404==t.status)throw new URIError("".concat(e,": not found"));return t})).then((function(e){var t=e.headers.get("content-type");if(t&&t.includes("application/json"))return e.json();throw new SyntaxError("MDQ didn't provide a JSON response")}))}function _(e,t,r,n){var o=n+e+".json";return console.log("json_mdq_get url: ",o),r&&t&&(o="".concat(o,"?entityID=").concat(encodeURIComponent(r),"&trustProfile=").concat(t)),m(o).then((function(e){return Array.isArray(e)&&e.length>0&&(e=e[0]),e}))}function E(e,t,r,n){return _(e,t,r,n).catch((function(e){console.log(e)}))}function S(e,t){return m(t+v(e)+".json").then((function(e){return"[object Array]"===Object.prototype.toString.call(e)&&(e=e[0]),e})).catch((function(e){console.log(e)}))}function g(e,t,r,n){var o=[];o.push("q=".concat(e)),r&&n&&(o.push("entityID=".concat(encodeURIComponent(r))),o.push("trustProfile=".concat(n)));var i="".concat(t,"?").concat(o.join("&"));return console.log("json_mdq_search url: ",i),m(i)}function O(e){var t={};return e.forEach((function(e){var r=e.split("=",2);2==r.length&&(t[r[0]]=decodeURIComponent(r[1].replace(/\+/g," ")))})),t}function b(e,t){var r=t.return;if(!r.startsWith("http://")&&!r.startsWith("https://"))throw new Error("Invalid return query param: ".concat(r));var n=-1===r.indexOf("?")?"?":"&",o=t.returnIDParam,i=e.entity_id;return o||(o="entityID"),i&&(r+=n+o+"="+i),r}var P=function(){return e=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"thiss.io",o=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mdq="function"==typeof t?t:function(e){return E(v(e),i,o,t)},this.mdq_sp=function(e){return S(e,t)},this.ps=r instanceof u?r:new u(r),this.context=n},t=[{key:"with_items",value:function(e){var t=this;this.ps.entities(this.context).then((function(t){return e(t.data)})).then((function(e){e&&e.data&&e.data.forEach((function(e){this.ps.update(t.context,e)}))}))}},{key:"saml_discovery_response",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.do_saml_discovery_response(e,t).then((function(e){var t=O(window.location.search.substr(1).split("&"));return b(e.entity,t)})).then((function(e){window.top.location.href=e})).catch((function(e){console.log(e)}))}},{key:"pin",value:function(e){return this.do_saml_discovery_response(e,!0)}},{key:"do_saml_discovery_response",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return r.ps.entity(r.context,e).then((function(e){return e.data})).then((function(n){return void 0===n?r.mdq(e).then((function(e){if(t)return r.ps.update(r.context,e).then((function(e){return e.data}));var n=Date.now(),o={entity:e,last_refresh:n,last_use:n};return Promise.resolve(o)})):Promise.resolve(n)})).catch((function(e){return console.log(e)}))}},{key:"remove",value:function(e){return this.ps.remove(this.context,e)}}],t&&w(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}()})(),n})()));